---
title: "Reporte Notas - Estadística Correlacional 2023 "
date: "2023-10-25"
lang: es
website:
  comments:
    giscus:
      repo: cursos-metodos-facso/correlacional
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE,
                      warning = FALSE)
```

# Prueba 1

## Librerías & datos 

```{r }
pacman::p_load(googlesheets4, dplyr, sjmisc,sjPlot, kableExtra, sjlabelled )
```

```{r echo=FALSE}
#Read google sheets data into R
prueba1 <- read_sheet('https://docs.google.com/spreadsheets/d/1ahL6yZpDRUmFFnilWHqMKchNqzVzAo7YZiA401crxGA/edit?usp=sharing', sheet = "puntaje-prueba1")

names(prueba1)
prueba1 <- prueba1 %>% rename("p1a"="p1-a", 
                              "p1b"="p1-b")
prueba1 <- prueba1 %>% dplyr::select(p1a:p5,nota_final)
```


```{r eval=FALSE}
load("prueba1.Rdata")
```


## Etiquetados
```{r}
# Label variables

prueba1$p1a <- set_label(x = prueba1$p1a, 
                         label = "Cálculo Pearson")
prueba1$p1b <- set_label(x = prueba1$p1b, 
                         label = "Interpretación Pearson")
prueba1$p2 <- set_label(x = prueba1$p2, 
                         label = "Limitación Pearson")
prueba1$p3 <- set_label(x = prueba1$p3, 
                         label = "Coeficiente determinación")
prueba1$p4 <- set_label(x = prueba1$p4, 
                         label = "Spearman")
prueba1$p5 <- set_label(x = prueba1$p5, 
                         label = "Perdidos matrices")

```


## Tabla descriptiva

```{r}
prueba1 %>% descr(., show = c("label","range", "mean", "sd", "n"))%>% kable(.,"markdown", digits=2)
```

## Gráficos descriptivos

```{r}
hist(prueba1$nota_final)
plot_frq(data = prueba1$nota_final,type = "hist",show.mean = T)
```


```{r}
prueba1 <- prueba1 %>%  mutate(notas_cat=cut(nota_final, breaks=c(-Inf,4,5,6, Inf), labels=c("Menor a 4.0","4.0-5.0","5.0-6.0","6.0-7.0")))

frq(prueba1$notas_cat)

prueba1 <- prueba1 %>% dplyr::select(-notas_cat)
```

## Preguntas y asociaciones

```{r}
tab_corr(prueba1,
         triangle = "lower")
```


```{r}
plot_scatter(prueba1, p1a, p1b)
```


**Consistencia interna**

```{r}
pacman::p_load(ltm)

preguntas <- prueba1 %>% dplyr::select(-nota_final)
cronbach.alpha(na.omit(preguntas))
```

# Prueba 2

## Datos 

```{r echo=FALSE, results=FALSE}
#Read google sheets data into R
prueba2 <- read_sheet('https://docs.google.com/spreadsheets/d/1lnZ7ojc3jxAMTFwC5Y_Wble08YaONTNTaPdz7KnDOXI/edit#gid=1600039458', sheet = "puntaje-prueba2")

names(prueba2)
prueba2 <- prueba2 %>% rename("p1a"="p1-a", 
                              "p1b"="p1-b",
                              "p1c"="p1-c",
                              "p2a"="p2-a",
                              "p2b"="p2-b",
                              "p2c"="p2-c")

prueba2 <- prueba2 %>% dplyr::select(forma,p1a:p2c,nota_final)
```


```{r eval=FALSE}
load("prueba2.Rdata")
```


## Adecuación preguntas

La prueba tiene dos formas: A y B, la única diferencia es en el orden de las preguntas, la forma A parte por la pregunta sobre identificación con la izquierda, mientras que en la forma B la primera pregunta es la de CASEN. Para poder realizar un correcto análisis de las preguntas vamos a adaptar la forma B a la A.

```{r}
frq(prueba2$forma)

A <- subset(prueba2, subset = prueba2$forma=="A")
B <- subset(prueba2, subset = prueba2$forma=="B")
dim(A)
dim(B)

descr(B, show = "mean")

B <- B %>% rename("p1a"="p2a", 
                  "p1b"="p2b",
                  "p1c"="p2c",
                  "p2a"="p1a",
                  "p2b"="p1b",
                  "p2c"="p1c")

descr(B, show = "mean")
prueba2 <- rbind(A,B)

```



## Etiquetados
```{r}
# Label variables

prueba2$p1a <- set_label(x = prueba2$p1a, 
                         label = "H1 promedio direccional")
prueba2$p1b <- set_label(x = prueba2$p1b, 
                         label = "Prueba promedios")
prueba2$p1c <- set_label(x = prueba2$p1c, 
                         label = "Rechazo H0")
prueba2$p2a <- set_label(x = prueba2$p2a, 
                         label = "H1 proporcion no direccional")
prueba2$p2b <- set_label(x = prueba2$p2b, 
                         label = "Error tipo 1")
prueba2$p2c <- set_label(x = prueba2$p2c, 
                         label = "Intervalo confianza")

```


## Tabla descriptiva

```{r}
prueba2 %>% descr(., show = c("label","range", "mean", "sd", "n"))%>% kable(.,"markdown", digits=2)
```

## Gráficos descriptivos

```{r}
hist(prueba2$nota_final)
plot_frq(data = prueba2$nota_final,type = "hist",show.mean = T)
```


```{r}
prueba2 <- prueba2 %>%  mutate(notas_cat=cut(nota_final, breaks=c(-Inf,4,5,6, Inf), labels=c("Menor a 4.0","4.0-5.0","5.0-6.0","6.0-7.0")))

frq(prueba2$notas_cat)

prueba2 <- prueba2 %>% dplyr::select(-notas_cat)
```

## Preguntas y asociaciones

```{r}
prueba2 <- prueba2 %>% dplyr::select(-forma)
tab_corr(prueba2,
         triangle = "lower")
```


**Consistencia interna**

```{r}
pacman::p_load(ltm)

preguntas <- prueba2 %>% dplyr::select(-nota_final)
cronbach.alpha(na.omit(preguntas))
```


# Pruebas 1 & 2

```{r}

# rescatar ID secuencial

prueba1 <- read_sheet('https://docs.google.com/spreadsheets/d/1ahL6yZpDRUmFFnilWHqMKchNqzVzAo7YZiA401crxGA/edit?usp=sharing', sheet = "Prueba 1 2023-10-10")

prueba2 <- read_sheet('https://docs.google.com/spreadsheets/d/1lnZ7ojc3jxAMTFwC5Y_Wble08YaONTNTaPdz7KnDOXI/edit#gid=1600039458', sheet ="Prueba 2 2023-11-19")

prueba1 <- prueba1 %>% dplyr::select(RUT,Nota) %>%  rename("Nota_p1"="Nota") 
prueba2 <- prueba2 %>% dplyr::select(RUT,Nota) %>% rename("Nota_p2"="Nota") 

pruebas <- merge(prueba1, prueba2, by = 'RUT')

plot_scatter(pruebas, Nota_p1, Nota_p2)
pruebas_c <-na.omit(pruebas)
cor(pruebas_c$Nota_p1, pruebas_c$Nota_p2)
```

