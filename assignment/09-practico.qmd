---
title: "Reportes dinámicos 3"
date: "2023-11-07"
lang: es
website:
  comments:
    giscus:
      repo: cursos-metodos-facso/correlacional
---

# Objetivo de la práctica

El objetivo de esta guía práctica es generar una plantilla de informe que nos sirva para desarrollar el trabajo final del curso.

En detalle, aprenderemos los siguientes contenidos:

1.  Organización de un informe en Quarto
2.  Generación y presentación de tablas y gráficos en Quarto.
3.  Cómo autoreferenciar elementos dentro un documento Quarto.

Además de la plantilla para el informe, dejamos a disposición una carpeta con un proyecto de R y la estructura de carpetas recomendada para la elaboración del trabajo:

-   *input*: insumos, libro de códigos
-   *input/data*: base de datos original
-   *procesamiento*: archivos de sintaxis .R o .qmd
-   *output*: bases de datos procesada, informes, tablas, gráficos

# Crear un documento Quarto

Para generar un documento Quarto hacemos lo siguiente:

![](../files/crear-rmd.gif)


# Organización de un informe en Quarto


## Encabezado o YAML

Para comenzar, definiremos los elementos que van en el encabezado (front matter o YAML), al menos debemos especificar:

-   Título
-   Subtítulo
-   Autores
-   Fecha
-   Idioma

![](../files/yaml_informe.png)

Con ese YAML el encabezado queda de la siguiente forma:

![](../files/encabezado.png)


## Apartados y subapartados

Para los títulos de los *apartados* deben poner un #, y para los *subapartados* cada vez más pequeños dos o más #.

Por ejemplo, si ponemos:

\# Variables

\## Descripción de variables

Los apartados y subapartados diferirán en su tamaño y se verán de esta forma.

![](../files/apartados.png)

::: {.callout-note}
Para los ejemplos de esta plantilla utilizaremos la encuesta ELSOC, pero como sabemos, el trabajo se realiza con la encuesta CASEN.
:::


# Informe

## Introducción

> En este apartado pueden poner su introducción, de acuerdo con la pauta del trabajo que se encuentra disponible en el [enlace](https://correlacional.netlify.app/trabajos).


## Variables

> En este apartado pueden poner sus variables, de acuerdo con la pauta del trabajo que se encuentra disponible en el [enlace](https://correlacional.netlify.app/trabajos).

Podemos cargar las librerías sin que aparezca en nuestro informe, señalando la especificación al chunk `echo=FALSE`.

    `r ''````{r librerias, echo=FALSE, warning=FALSE, message=FALSE, collapse=TRUE}
    library(pacman)
    pacman::p_load(tidyverse,   # manipulacion datos
                   sjPlot,      # tablas
                   confintr,    # IC
                   gginference, # visualizacion 
                   rempsyc,     # reporte
                   broom,       # varios
                   sjmisc)      # para descriptivos       

    options(scipen = 999) # para desactivar notacion cientifica
    rm(list = ls()) # para limpiar el entorno de trabajo

    ````

```{r librerias, echo=FALSE, warning=FALSE, message=FALSE, collapse=TRUE}
library(pacman)
pacman::p_load(tidyverse,   # manipulacion datos
               sjPlot,      # tablas
               confintr,    # IC
               gginference, # visualizacion 
               rempsyc,     # reporte
               broom,       # varios
               sjmisc)      # para descriptivos       

options(scipen = 999) # para desactivar notacion cientifica
rm(list = ls()) # para limpiar el entorno de trabajo
```

Esto lo podemos repetir para la carga de la base de datos y el procesamiento de los datos.

    `r ''````{r datos, echo=FALSE, warning=FALSE, message=FALSE}
    load("../input/data/ELSOC_Long.RData")
    ````

```{r datos, echo=FALSE, warning=FALSE, message=FALSE}
load(url("https://dataverse.harvard.edu/api/access/datafile/7245118"))
```

    `r ''````{r procesamiento, echo=FALSE, warning=FALSE, message=FALSE}
    # Filtrar casos y seleccionar variables
      data <- elsoc_long_2016_2022 %>% 
      filter(ola==1) %>%
      select(m0_sexo,m0_edad,m01,s11_01,s11_02,s11_03,s11_04,s11_05,s11_06,s11_07,s11_08,s11_09)

    # remover NA's
      data <- data %>% 
      set_na(., na = c(-888, -999)) %>% 
      na.omit()

    # crear variable nueva 
      data <- data %>% 
      rowwise() %>%
      mutate(sint_depresivos = mean(c(s11_01,s11_02,s11_03,s11_04,s11_05,s11_06,s11_07,s11_08,s11_09))) %>% 
      ungroup()
    ````
    
```{r procesamiento, echo=FALSE, warning=FALSE, message=FALSE}
# Filtrar casos y seleccionar variables
data <- elsoc_long_2016_2022.2 %>% 
  filter(ola==1) %>%
  select(m0_sexo,m0_edad,m01,s11_01,s11_02,s11_03,s11_04,s11_05,s11_06,s11_07,s11_08,s11_09)

# remover NA's
data <- data %>% 
  set_na(., na = c(-888, -999)) %>% 
  na.omit()

# crear variable nueva 
data <- data %>% 
  rowwise() %>%
  mutate(sint_depresivos = mean(c(s11_01,s11_02,s11_03,s11_04,s11_05,s11_06,s11_07,s11_08,s11_09))) %>% 
  ungroup()
```


## Descripción de variables

En este ejemplo, se seleccionaron las variables:

-   sexo: sexo del encuestado, con nivel de medición nominal
-   edad: edad del encuestado, con nivel de medición intervalar

Y las variables del módulo de Salud y Bienestar, referentes a *Estado de ánimo: sintomatología depresiva*, con nivel de medición ordinal, los ítems son los siguientes:

-   Frecuencia: Poco interés o alegría
-   Frecuencia: Decaimiento, pesadez o desesperanza
-   Frecuencia: Dificultad para dormir o exceso de sueño
-   Frecuencia: Cansancio o sensación de falta de energía
-   Frecuencia: Apetito disminuido o aumentado
-   Frecuencia: Dificultad para concentrarse
-   Frecuencia: Mala opinión de sí mismo
-   Frecuencia: Enlentecimiento físico
-   Frecuencia: Pensamiento de muerte o dañarse



```{r, echo=FALSE, warning=FALSE, message=FALSE}
tab1 <- data %>%
  group_by(m0_sexo) %>% # agrupamos por sexo
  summarise(n = n()) %>% # contamos por categ de respuesta
  mutate(prop = round((n / sum(n)) * 100, 2)) # porcentaje
 
pm <- as.numeric(tab1[2,3])
ph <- as.numeric(tab1[1,3])

tabla1 <- tab1 %>% 
  kableExtra::kable(format = "html",
                    align = "c",
                    col.names = c("Sexo", "n", "Proporción"),
                    caption = "Tabla 1. Distribución de sexo") %>% 
  kableExtra::kable_classic(full_width = FALSE, position = "center", font_size = 14) %>% 
  kableExtra::add_footnote(label = "Fuente: Elaboración propia en base a ELSOC 2016.")

```

En la @tbl-sexo podemos ver que la proporción de mujeres que responde la encuesta corresponde a `r pm`%, mientras que la propoción de hombres corresponde a `r ph`%.

```{r tbl-sexo, echo=FALSE, warning=FALSE, message=FALSE}
#| label: tbl-sexo
#| tbl-cap: "Distribución de sexo"
#| tbl-cap-location: top
#| warning: false
tabla1
```

## Análisis

> En este apartado pueden poner sus análisis, de acuerdo con la pauta del trabajo que se encuentra disponible en el [enlace](https://correlacional.netlify.app/trabajos).

Aqui ponemos el análisis, de acuerdo con la  [pauta](https://correlacional.netlify.app/trabajos).

```{r, echo=FALSE, warning=FALSE, message=FALSE}
cor_edad_dep <- cor(data$m0_edad, data$sint_depresivos)
cor_nedu_dep <- cor(data$m01, data$sint_depresivos)
cor_nedu_edad <- cor(data$m01, data$m0_edad)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
g1 <- data %>% 
  group_by(m01) %>% 
  summarise(sint_dep = mean(sint_depresivos, na.rm = T),
            edad=mean(m0_edad, na.rm = T))

grafico1 <- ggplot(data = g1,
       mapping = aes(x = sint_dep, y = edad, label = m01)) +
  geom_point() +
  geom_smooth(method = "lm",colour = "black",fill="lightblue",size=0.5) + 
  labs(x = "Sintomatología depresiva",
       y = "Edad",
       caption = "Fuente: Elaboración propia en base a ELSOC 2026") +
  theme_bw()

```

En la @fig-cor_edad_dep es posible apreciar... La correlación entre la edad y el promedio de la sintomatología depresiva corresponde a `r cor_edad_dep`

```{r fig-cor_edad_dep, echo=FALSE}
#| label: fig-cor_edad_dep
#| fig-cap: "Correlación entre edad y sintomatología depresiva"
#| warning: false
#| message: false
#| fig-align: center
#| out-width: 80%
grafico1
```


## Conclusiones

> En este apartado pueden poner sus conclusiones, de acuerdo con la pauta del trabajo que se encuentra disponible en el [enlace](https://correlacional.netlify.app/trabajos).

Aquí redactamos algunas conclusiones.

##  Bibliografía

> En este apartado pueden poner su bibliografía, de acuerdo con la pauta del trabajo que se encuentra disponible en el [enlace](https://correlacional.netlify.app/trabajos).

Ponemos un `-` para generar un listado.

-   COES (2023). *Radiografía del Cambio Social: Análisis de Resultados Longitudinales ELSOC 2016-2022. Presentación de Resultados COES*. Marzo, Santiago de Chile.

-   R Core Team (2023). *R: A Language and Environment for Statistical Computing*. R Foundation for Statistical Computing, Vienna, Austria. <https://www.R-project.org/>.



# Video de práctica

{{< video https://youtu.be/-nvtdhKOD9E >}}

# Foro

```{=html}
<script src="https://giscus.app/client.js"
        data-repo="cursos-metodos-facso/correlacional"
        data-repo-id="R_kgDOKCMXJQ"
        data-category="Q&A"
        data-category-id="DIC_kwDOKCMXJc4CYd9S"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="es"
        crossorigin="anonymous"
        async>
</script>
```
