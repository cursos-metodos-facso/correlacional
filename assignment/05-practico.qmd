---
title: "Práctico 5: Asociación entre categóricas"
date: "2024-10-08"
lang: es
bibliography: "bib/correlacional.bib"
csl: "bib/apa.csl"
execute:
  freeze: auto
  cache: false 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    warning = F,
    error = F,
    message = F
)
```

# Objetivo de la práctica

El objetivo de esta guía práctica es introducir herramientas estadísticas para el análisis de relación entre variables categóricas (nominales).

En detalle, aprenderemos a:

1. Aplicar coeficientes de correlación entre variables categóricas (nominales-ordinales)
2. Generar y analizar tablas de contingencia (o cruzadas)
3.  Estimar e interpretar la prueba de Chi-cuadrado ($X^2$)

En esta guía utilizaremos un ejemplo que desarrollaremos progresivamente para exponer los contenidos. Al final de esta guía se proporciona un ejercicio autónomo que deberá resolver de manera individual o grupal tomando como referencia el ejemplo aquí expuesto.

# 1. Pregunta de investigación

La erradicación de la violencia es un objetivo compartido por múltiples países y organizaciones internacionales (World Health Organization, 2009, 2010, 2014). Sin embargo, la violencia no es un fenómeno que se pueda erradicar en el corto plazo, más bien es un fenómeno con el cual se debe coexistir planteando límites para su uso (Keane, 2004). Dicho de otra forma, coexistir con la violencia implica determinar las situaciones en que su uso estaría justificado. Las movilizaciones masivas del 2019 en Chile son un claro ejemplo de un evento donde distintos tipos de violencia fueron justificadas. Estas movilizaciones se caracterizaron por violaciones sistemáticas a los derechos humanos de parte de la policía (Amnistía Internacional, 2020), así como también por un alza en la cantidad de protesta violenta (Joignant et al., 2020). Ante este panorama, la violencia como forma de protesta tuvo un incremento en sus niveles de justificación, mientras que la justificación a la violencia policial disminuyó considerablemente (González et al., 2019). El ascenso en los niveles de justificación se torna especialmente relevante si se tiene en consideración que aquellos que justifican la violencia son más tendientes a ejercerla (Nunes et al., 2021), amenzando la convivencia pacífica al largo plazo (Gerber, Carvacho, et al., 2017). Ante esta problemática, se abren las interrogantes sobre ¿quienes y por qué justifican la violencia?

El estudio de las justificaciones de la violencia distingue si esta se ejerce por el cambio social o por el control social. En la literatura empírica se han ofrecido tres explicaciones. La primera es que quienes pertenecen a grupos desaventajados tienden a justificar actos violentos que buscan generar algún cambio en las estructuras jerárquicas de la sociedad. La segunda es que quienes poseen ideologías más cercanas al autoritarismo o a la dominancia social, tienden a justificar más la violencia que mantiene el status quo. La tercera es que quienes perciben que son tratados de manera injusta de parte de las autoridades, las legitiman menos y, por ende, justifican menos la violencia que estas ejerzan. Esta última explicación es la que ha recibido más desarrollo en el último tiempo, relevando el rol que tiene sentir injusticia en el trato en la justificación de la violencia. Sin embargo, en este estudio se parte de la premisa que la justicia no es un concepto unidimensional, sino uno multidimensional. A raíz de ello, se propone integrar a la justicia distributiva como una dimensión relevante para explicar las dinámicas de la justificación de la violencia, en tanto es un motivador de la acción humana a nivel micro y macro (Liebig, 2016). La pregunta de investigación que guía el estudio es:

**Pregunta 1**: _¿En qué medida se relacionan el sentido de injusticia distributiva y la justificación de la violencia por el **cambio social** en Chile al año 2019?_

> H1: A mayor sentido de injusticia distributiva, mayor es la justificación de la violencia por el cambio social

**Pregunta 2**: _¿En qué medida se relacionan el sentido de injusticia distributiva y la justificación de la violencia por el **control social** en Chile al año 2019?_

> H2: A mayor sentido de injusticia distributiva, menor es la justificación de la violencia por el control social


## Recursos de la práctica

En esta práctica trabajaremos con un subconjunto de datos previamente procesados de la [Encuesta Social Longitudinal de Chile (ELSOC)](https://coes.cl/encuesta-panel/) para Chile del año 2019. Para este ejercicio, obtendremos directamente esta base desde internet. No obstante, también es posible acceder a la misma información a través del siguiente enlace: [{{< fa table >}} `ELSOC 2019`](https://github.com/cursos-metodos-facso/datos-ejemplos/raw/refs/heads/main/elsoc2019_jv.RData). Desde allí, podrás descargar el archivo que contiene el subconjunto procesado de la base de datos ELSOC 2019.

# 2. Datos y librerías

Comencemos por preparar nuestros datos. Iniciamos cargando las librerías necesarias.

```{r librerias, echo=TRUE, collapse=TRUE}
pacman::p_load(tidyverse, # Manipulacion datos
               sjPlot, # Graficos y tablas
               sjmisc, # Descriptivos
               kableExtra, # Tablas
               psych, # Estadísticos
               broom) # Varios

options(scipen = 999) # para desactivar notacion cientifica
rm(list = ls()) # para limpiar el entorno de trabajo
```

Cargamos los datos directamente desde internet.

```{r datos, echo=TRUE}

# Cargar bbdd desde internet
load(url("https://github.com/cursos-metodos-facso/datos-ejemplos/raw/refs/heads/main/elsoc2019_jv.RData"))

```

A continuación, exploramos el subset de datos `elsoc`.

```{r exploracion, echo=TRUE}

names(elsoc) # Nombre de columnas
dim(elsoc) # Dimensiones

```

```{r include = F}
rows <- NROW(elsoc)
cols <- NCOL(elsoc)
```

Contamos con `r cols` variables (columnas) y `r rows` observaciones (filas).

Ahora, realizaremos un pequeño procesamiento de nuestros datos con `dplyr`, todo de una vez mediante el uso de pipes `%>%`. Para recordar los pasos para el procesamiento de datos, revisar la guía práctica del [curso de estadística descriptiva](https://descriptiva-facso.netlify.app/assignment/03-practico).

```{r proc, echo=TRUE, }

proc_elsoc <- elsoc %>% # seleccionamos
    dplyr::select(
      starts_with("jv"),
      starts_with("sj")
      ) 

```

Ahora, exploremos estadísticos descriptivos de nuestra base procesada `proc_elsoc`

```{r descr, echo=TRUE}

proc_elsoc %>% 
  sjmisc::descr(show = c("label","range", "mean", "sd", "NA.prc", "n")) %>%
  kable(.,"markdown")

```

# 3. Análisis

En [ELSOC 2019](https://www.gesis.org/en/issp/data-and-documentation/social-inequality/2009) la justificación de la violencia se mide con una escala que incluye distintas situaciones de violencia. Nosotros tomaremos dos items:

<style>
  table {
    margin-left: auto; /* Ajustamos el margen izquierdo a automático */
    margin-right: auto; /* Ajustamos el margen derecho a automático */
    border-collapse: collapse;
    width: 60%;
    border: 2px solid black;
  }
  
  th, td {
    border: 1px solid #D3D3D3;
    padding: 8px;
    text-align: center;
  }
</style>

**Justificación de la violencia**: _F05 ¿En qué medida cree usted que se justifican o no se justifican las siguientes situaciones?_

| Ítem | Categorías de respuesta |
|:------------:|:------------:|
| F05_03 Que Carabineros use la fuerza para reprimir una manifestación pacífica  | Nunca se justifica (1); Pocas veces se justifica (2); Algunas veces de justifica (3); Muchas veces se justifica (4); Siempre se justifica (5) |
| F05_07 Que estudiantes tiren piedras a Carabineros en una marcha por la educación del país   | Nunca se justifica (1); Pocas veces se justifica (2); Algunas veces de justifica (3); Muchas veces se justifica (4); Siempre se justifica (5) |

Originalmente, esta variable es ordinal, sin embargo, para efectos del ejemplo de este práctico, trabajaremos con la variable recodificada de la siguiente manera:

- **Justifica (1)** = Pocas veces se justifica (2); Algunas veces de justifica (3); Muchas veces se justifica (4); Siempre se justifica (5)
- **No justifica (0)** = Nunca se justifica (1)

Por otro lado, el **sentido de injusticia distribuva** se mide con un indicador denominado _evaluación de injusticia_ (Jasso, 1980). Este representa cuanta justicia evalúan las personas en la distribución de recompensas de una situación. En este caso, representa la evalaución de qué tan justa es la distribución de ingresos de _un gerente hipótetico_, en tanto este representa el extremo mayor del espectro ocupacional. El indicador (en una versión simplificada) se lee de la siguiente manera:

> A mayor valor, los gerentes están más injustamente sobrerecompensados (se evalúa más injusticia en su situación)

## 3.1 Correlación para variables nominales

### 3.1.1 Correlación punto biserial

La correlación punto biserial es una extensión del coeficiente de correlación de Pearson y se utiliza cuando una de las variables de estudio tienen un nivel de medición intervalar y la otra un nivel de medición nominal.

- El nombre de _punto biserial_ es una forma de diferenciarla de la correlación de Pearson
- Esta diferenciación es importante ya que nos prevee de que hay que tener consideraciones con su interpretación, particularmente en lo que refiere al *sentido*
- En lo que respecta a la *magnitud/tamaño* y la *inferencia*, sigue la misma lógica que hemos visto con la correlación de Pearson

Para calcular este coeficiente en R utilizamos una función ya conocida: `cor.test()`. Probemoslo con las variables `jv_cambio_rec` y `sj_gerente`.

Primero, veamos la frecuencia de `jv_cambio_rec` y `sj_gerente`.


```{r, echo = TRUE, warning = FALSE, collapse = TRUE}
sjmisc::frq(proc_elsoc$jv_cambio_rec)

mean(proc_elsoc$sj_gerente, na.rm = TRUE)
```

Obtengamos la correlación punto biserial entre justificación de la violencia por el cambio social y evaluación de justicia para gerentes.

```{r, warning=FALSE}
cor.test(proc_elsoc$jv_cambio_rec, proc_elsoc$sj_gerente)
```

```{r, warning=FALSE, include=FALSE}
rpb <- round(cor.test(proc_elsoc$jv_cambio_rec, proc_elsoc$sj_gerente)$estimate, 2)
```

Vemos que la correlación entre el sentido de injusticia distributiva (`sj_gerente`) y la justificación de la violencia por el cambio social (`jv_cambio_rec`) es positiva, pequeña y estadísticamente significativa ($r$ = `r rpb`; _p < 0.05_)

### 3.1.2 Correlación tetracorica

La correlación tetracórica también es una extensión del coeficiente de correlación de Pearson, con la diferencia de que se usa cuando amabs variables de estudio son nominales dicotomicas (2 valores).

- Se calcula en base a la frecuencias de cada combinación de valores (00,01,10,11).
- Supone que ambas variables son continuas y normalmente distribuidas antes de la categorización

Veamos como vería una correlación tetracórica entre nuestras variables de estudio. En este caso, vamos a usar `jv_cambio` que ya es dicotomica (1 = Justifica, 0 = No justifica) y una versión recodificada del sentido de injusticia `sj_gerente_rec` (1 = Injusto, 0 = Justo)

Primero, veamos las frecuencias entre `jv_cambio_rec` y `sj_gerente_rec`.

```{r, echo = TRUE, warning = FALSE, collapse = TRUE}
sjmisc::frq(proc_elsoc$jv_cambio_rec)

sjmisc::frq(proc_elsoc$sj_gerente_rec)
```

Obtengamos la correlación tetracórica entre `jv_cambio_rec` y `sj_gerente_rec`.

```{r, warning=FALSE}
matriz <- proc_elsoc %>% 
  dplyr::select(jv_cambio_rec, sj_gerente_rec) # creamos matriz con var de interes

psych::tetrachoric(matriz, na.rm = T)
```

```{r, warning=FALSE, include=FALSE}
rt <- round(psych::tetrachoric(matriz, na.rm = T)$rho[2,1], 2)
```

Vemos que la correlación entre el sentido de injusticia distributiva recodificado (`sj_gerente_rec`) y la justificación de la violencia por el cambio social (`jv_cambio_rec`) es positiva, muy pequeña y estadísticamente significativa ($r$ = `r rt`; _p < 0.05_).

## 3.2 Tablas de contingencia

Las tablas de contingencia son herramientas estadísticas utilizadas para resumir y analizar la relación entre dos o más variables categóricas. Estas tablas muestran la frecuencia de diferentes combinaciones de categorías de las variables, facilitando la visualización de patrones o asociaciones.

Dicho de otra manera, podemos saber cuántos casos de una determinada categoría de la variable $Y$ ocurren conjuntamente con una determinada categoría de la variable $X$. 

Veamos una tabla con nuestro ejemplo usando el comando `sjtab`.

```{r, warning=FALSE}
proc_elsoc %>%
  sjPlot::sjtab(sj_gerente_rec,
        jv_cambio_rec,
        show.row.prc=TRUE, # porcentaje fila
        show.col.prc=TRUE # porcentaje columna
  )
```

En esta tabla vemos que los porcentajes coloreados en azul corresponde a las filas y el verde el porcentaje que corresponde a las columnas. Utilizando esta información podemos decir, por ejemplo:

- El 25.8% de quienes consideran que los gerentes están injustamente recompensados justifica la violencia por el cambio social

- El 91.6% de quienes justifican la violencia por el cambio social consideran que los gerentes están justamente recompensados

Ahora, ¿cómo sabemos si hay asociación? Repliquemos el ejemplo que vimos en clases, utilizando nuestras variables. Imaginemos que tenemos una base de datos con _N = 100_.

```{r, warning=FALSE, include=FALSE}
# Ejemplo de asociación perfecta
tab1 <- data.frame(
  "." = c("Justo", "Injusto", "Total"),
  `No justifica` = c(50, 0, 50),
  "Justifica" = c(0, 50, 50),
  Total = c(100, 100, 100)
  )

# Ejemplo de no asociación
tab2 <- data.frame(
  "." = c("Justo", "Injusto", "Total"),
  `No justifica` = c(25, 25, 50),
  "Justifica" = c(25, 25, 50),
  Total = c(100, 100, 100)
  )
```

Una distribución con evidencia "perfecta" para nuestra hipótesis alternativa se puede ver en la siguiente tabla:

```{r, warning=FALSE}
tab1 %>% 
  kable(format = "html", align = 'r', col.names = c("Sentido (in)justicia", "No justifica violencia", "Justifica violencia", "Total")) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T) %>% 
  kableExtra::kable_styling(latex_options = "hold_position", position = "center")
```

En contraste, una distribución que representaría un caso perfecto de no asociación, se puede ver en la siguiente tabla:

```{r, warning=FALSE}
tab2 %>% 
  kable(format = "html", align = 'r', col.names = c("Sentido (in)justicia", "No justifica violencia", "Justifica violencia", "Total")) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T) %>% 
  kableExtra::kable_styling(latex_options = "hold_position", position = "center")
```

## 3.3. Prueba de hipótesis con Chi cuadrado ($X^2$)

Para determinar si existe una asociación significativa entre dos variables categóricas se utiliza la prueba de Chi-cudrado ($X^2$). Esta se basa en un test de diferencia, donde se compara nuestra tabla de contingencia y una tabla donde no existe asociación entre variables ($H_0$), que representa la hipótesis nula. **La lógica detrás es que si nuestra tabla es significativamente distinta de una tabla sin asociación, entonces podemos rechazar la hipóteis nula**.

::: {.callout-tip}
#### Prueba de Chi-cuadrado

Contrastamos la _hipótesis nula_ (o de trabajo) de que las variables son idenpendientes entre ellas:
$$  H_{0}: \pi_{fc} =  \pi_{f}\pi_{c} $$

En relación a una _hipótesis alternativa_ sobre que las variables están relacionadas:
$$  H_{A}:  \pi_{fc} \neq  \pi_{f}\pi_{c} $$
:::


En R, utilizamos la función `chisq.test()`:

```{r, warning=FALSE}
chi_results <- chisq.test(proc_elsoc$sj_gerente_rec, proc_elsoc$jv_cambio_rec)

chi_results
```

Obtuvimos nuestro resultado, pero no es muy amigable a la vista. Generemos una tabla de calidad para que sea reportable.

```{r}
#| label: tbl-chi
#| echo: true
#| warning: false

stats.table <- tidy(chi_results)

stats.table %>%
    dplyr::mutate(
        statistic = round(statistic, 2),
        p_value = case_when(
            p.value < 0.05 & p.value > 0.01 ~ "< 0.05*",
            p.value < 0.01 & p.value > 0.001 ~ "< 0.01**",
            p.value < 0.001 ~ "< 0.001***",
            TRUE ~ ""
        )
    ) %>%
    dplyr::select(statistic, p_value, parameter, method) %>%
    kableExtra::kable(format = "html",
        col.names = c("X2", "p-value", "df", "Método"),
        booktabs = T,
        caption = "Prueba de Chi-cuadrado entre justificación de la violencia por cambio social e injusticia distributiva"
    ) %>%
    kableExtra::kable_styling(
        bootstrap_options = c("striped", "hover", "condensed", "responsive"),
        full_width = T,
        latex_options = "hold_position",
        position = "center"
    ) %>% 
    column_spec(4, width = "8cm")
```

```{r, warning=FALSE, include=F}
xi <- round(chisq.test(proc_elsoc$sj_gerente_rec, proc_elsoc$jv_cambio_rec)$statistic[[1]],3)
```

A partir de estos resultados, podemos reportar lo siguiente:

> A raíz de la prueba de $X^2$, vemos que existe evidencia para rechazar la hipótesis nula sobre no asociación, generando evidencia a favor de nuestra hipótesis alternativa sobre una asociación estadísticamente significativa entre el sentido de injusticia distributiva y la justificación de la violencia por el cambio social ($X^2$ = `r xi`, _p < 0.05_)


# 4. Conclusiones

### Pregunta 1

**Pregunta 1**: _¿En qué medida se relacionan el sentido de injusticia distributiva y la justificación de la violencia por el **cambio social** en Chile al año 2019?_

Para responder esta pregunta debemos emplear la técnica de Chi-cuadrado $X^2$ para contrastar la hipótesis respecto a que existe una asoción entre el sentido de injusticia distributiva y la justificación de la violencia por el _cambio social_, ya que ambas variables son categóricas (nominales).

De acuerdo con los resultados obtenidos en la @tbl-chi, existe una asociación estadísticamente significativa entre el sentido de injusticia distributiva y la justificación de la violencia por el cambio social ($X^2$ = `r xi`, _p < 0.05_). Con todo, podemos sostener que la justificación del uso de la violencia por motivos de cambio social se ve influida por el grado de injusticia distributiva en los ingresos. 

# Ejercicio autónomo

A partir de la base de datos de `proc_elsoc` responda la pregunta 2 planteada al inicio de este ejercicio. Es decir: _¿En qué medida se relacionan el sentido de injusticia distributiva y la justificación de la violencia por el **control social** en Chile al año 2019?_

1. Estime la correlación adecauda para `sj_gerente` y `jv_control_rec`.
2. Presente en una tabla de contingencia entre las variables `sj_gerente_rec` y `jv_control_rec`.
3. Calcule el estadístico de Chi cuadrado ($X^2$) entre las variables `sj_gerente_rec` y `jv_control_rec`.
4. Interprete los resultados obtenidos. Responda la pregunta de investigación a raíz de los calculos desarrolaldos.


#### Referencias

Amnistía Internacional. (2020). Ojos sobre Chile. Amnistía Internacional.
Gerber, M., González, R., Carvacho, H., Jiménez-Moya, G., & Jackson, J. (2017). On the justification of intergroup violence: The roles of procedural justice, police legitimacy and group identity in attitudes towards violence among indigenous people. Psychology of Violence, 8(3), 379–389. https://doi.org/10.1037/vio0000177
González, R., Bargsted, M., Carvacho, H., Miranda, D., Cerda, E., Mella, M., & Plaza, A. (2019). Radiografía del cambio social: Análisis de Resultados Longitudinales Estudio Longitudinal Social de Chile. Centro de Estudios de Conflicto y Cohesión Social.
Jasso, G. (1980). A New Theory of Distributive Justice. American Sociological Review, 45(1), 3–32. https://doi.org/https://www.jstor.org/stable/2095239 JSTOR
Joignant, A., Garretón, M., Somma, N. M., & Campos, T. (2020). Informe Anual: Observatorio de Conflictos 2020. Centro de Estudios de Conflicto y Cohesión Social COES. https://doi.org/10.13140/RG.2.2.20137.83048
Keane, J. (2004). Violence and Democracy (1st ed.). Cambridge University press.
Liebig, S., & Sauer, C. (2016). Sociology of justice. Handbook of social justice theory and research, 37-59.
World Health Organization. (2009). Changing cultural and social norms that support violence.
World Health Organization. (2010). Violence prevention: the evidence.
World Health Organization. (2014). Global Status Report on Violence Prevention 2014.