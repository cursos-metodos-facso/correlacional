---
title: "Práctico 5: Asociación entre categóricas"
date: "2025-10-13"
lang: es
bibliography: "bib/correlacional.bib"
csl: "bib/apa.csl"
execute:
  freeze: auto
  cache: false 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    warning = F,
    error = F,
    message = F
)
```

# Objetivo de la práctica

El objetivo de esta guía práctica es introducir herramientas estadísticas para el análisis de relación entre variables categóricas (nominales).

En detalle, aprenderemos a:

1. Aplicar coeficientes de correlación entre variables categóricas (nominales-ordinales)
2. Generar y analizar tablas de contingencia (o cruzadas)
3. Estimar e interpretar la prueba de Chi-cuadrado ($X^2$)
4. Interpretar medidas de magnitud para pruebas con variables categóricas
5. Realizar pruebas de hipótesis para proporciones

En esta guía utilizaremos un ejemplo que desarrollaremos progresivamente para exponer los contenidos. Al final de esta guía se proporciona un ejercicio autónomo que deberá resolver de manera individual o grupal tomando como referencia el ejemplo aquí expuesto.

# 1. Pregunta de investigación

En esta práctica trabajaremos con un subconjunto de datos previamente procesados de la Encuesta de Caracterización Socioeconómica (CASEN) del año 2022, elaborada por el [Ministerio de Desarrollo Social y Familia](https://observatorio.ministeriodesarrollosocial.gob.cl/). Para este ejercicio, obtendremos directamente esta base desde internet. No obstante, también tienen la opción de acceder a la misma información a través del siguiente enlace: [{{< fa table >}} `CASEN 20222`](https://github.com/cursos-metodos-facso/datos-ejemplos/raw/main/proc_casen.RData). Desde allí, podrás descargar el archivo que contiene el subconjunto procesado de la base de datos CASEN 2022.

# 2. Datos y librerías

Comencemos por preparar nuestros datos. Iniciamos cargando las librerías necesarias.

```{r librerias, echo=TRUE, collapse=TRUE}
pacman::p_load(
    dplyr, # Manipulacion datos
    sjPlot, # Graficos y tablas
    sjmisc, # Descriptivos
    kableExtra, # Tablas
    psych, # Estadísticos
    broom,
    rempsyc,
    sjstats,
    gginference
) # Varios

options(scipen = 999) # para desactivar notacion cientifica
rm(list = ls()) # para limpiar el entorno de trabajo
```

Cargamos los datos directamente desde internet.

```{r datos}
load(url("https://github.com/cursos-metodos-facso/datos-ejemplos/raw/main/casen_proc.RData")) #Cargar base de datos
```

A continuación, exploramos el subset de datos `proc_casen`.

```{r exploracion, echo=TRUE}

names(proc_casen) # Nombre de columnas
dim(proc_casen) # Dimensiones

```

```{r include = F}
rows <- NROW(proc_casen)
cols <- NCOL(proc_casen)
```

Contamos con `r cols` variables (columnas) y `r rows` observaciones (filas).

# 3. Análisis

## 3.1 Correlación para variables nominales

Al igual que otros coeficientes de correlación, las correlaciones entre categóricas:

- Oscila entre -1 y 1.
- Indica la dirección y fuerza de asociación entre variables.
- Su tamaño de efecto se puede interpretar a partir de ciertos estándares.
- Se interpreta de la misma forma que otros coeficientes de correlación.

### 3.1.1 Correlación punto biserial

La correlación punto biserial se utiliza para calcular la correlación entre una variable categórica dicotómica y una variable continua.

Veamos la frecuencia de `sexo` y la media de ingresos `y1`.

```{r}
sjmisc::frq(proc_casen$sexo)

mean(proc_casen$y1, na.rm = T)
```

Obtengamos la correlación punto biserial entre sexo e ingresos.

```{r}
cor.test(proc_casen$sexo, proc_casen$y1)
```

### 3.1.2 Correlación tetracorica

La correlación tetracórica se utiliza para calcular la correlación entre dos variables binarias categóricas, es decir, variables nominales dicómoticas (solo dos posibles valores).

Veamos las frecuencias de `sexo` y `disc_fisica`.

```{r}
sjmisc::frq(proc_casen$sexo)

sjmisc::frq(proc_casen$disc_fisica)
```

Obtengamos la correlación tetrácorica entre sexo y discriminación por apariencia física.

```{r}
matriz <- proc_casen %>% select(sexo, disc_fisica) # creamos matriz con var de interes

psych::tetrachoric(matriz, na.rm = T)
```

### 3.1.3. Correlación Policórica

La correlación policórica se utiliza para calcular la correlación entre dos variables ordinales categóricas, es decir, variables ordinales cuyos posibles valores siguen un orden (por ejemplo, variables tipo Likert).

Veamos las frecuencias de `ayuda_moverse` y `ayuda_thogar`.

```{r}
sjmisc::frq(proc_casen$ayuda_moverse)

sjmisc::frq(proc_casen$ayuda_thogar)
```

Obtengamos la correlación policórica entre si la persona necesitó ayuda para moverse dentro de la casa y si necesitó ayuda para realizar tareas dentro del hogar, en los últimos 30 días.

```{r}
matriz <- proc_casen %>% select(ayuda_moverse, ayuda_thogar) # creamos matriz con var de interes

psych::polychoric(matriz, na.rm = T)
```

## 3.2 Tablas de contingencia

Una tabla de contingencia es una de las maneras más simples y útiles para representar el cruce entre dos variables categóricas.

Con ella, podemos obtener en las celdas las frecuencias **conjuntas** entre ambas variables, es decir, cuántos casos de una determinada categoría de la variable `Y` ocurren conjuntamente con una determinada categoría de la variable `X`. 

Además, podemos presentar los totales de cada fila y columna al exterior de la tabla, también conocidas como frecuencias **marginales**.

Veamos un ejemplo con `ss_salud` y `universitaria`:

```{r}
sjPlot::sjt.xtab(var.row = proc_casen$ss_salud, var.col = proc_casen$universitaria, 
                 show.summary = F, emph.total = T)
```

Veamos cómo incorporar el porcentaje fila y columna en la tabla.

```{r}
sjPlot::sjt.xtab(var.row = proc_casen$ss_salud, 
                 var.col = proc_casen$universitaria, 
                 show.summary = F, 
                 emph.total = T, 
                 show.row.prc = T, # porcentaje fila
                 show.col.prc = T # porcentaje columna
                 )
```

Aquí, los porcentajes fila aparecen en azul y los porcentajes columna en verde. 

## 3.3. Prueba de hipótesis con Chi cuadrado ($X^2$)

Para determinar si existe una asociación significativa entre dos variables categóricas se utiliza la prueba de Chi-cudrado ($X^2$). Esta se basa en un test de diferencia, donde se compara nuestra tabla de contingencia y una tabla donde no existe asociación entre variables ($H_0$), que representa la hipótesis nula. **La lógica detrás es que si nuestra tabla es significativamente distinta de una tabla sin asociación, entonces podemos rechazar la hipóteis nula**.

::: {.callout-tip}
#### Prueba de Chi-cuadrado

Contrastamos la _hipótesis nula_ (o de trabajo) de que las variables son independientes entre ellas:
$$  H_{0}: \pi_{fc} =  \pi_{f}\pi_{c} $$

En relación a una _hipótesis alternativa_ sobre que las variables están relacionadas:
$$  H_{A}:  \pi_{fc} \neq  \pi_{f}\pi_{c} $$
:::

Veamos un ejemplo con nuestros datos. Evaluemos si el nivel educacional se relaciona con el tipo de sistema de salud al que pertenecen las personas en Chile durante el 2022.

En R, utilizamos la función `chisq.test()`:

```{r, warning=FALSE}
chi_results <- chisq.test(table(proc_casen$ss_salud, proc_casen$universitaria))

chi_results
```

Obtuvimos nuestro resultado, pero no es muy amigable a la vista. Generemos una tabla de calidad para que sea reportable.

```{r}
#| label: tbl-chi
#| echo: true
#| warning: false

stats.table <- tidy(chi_results, conf_int = T)
nice_table(stats.table)
```

Visualicemos la distribución de esta prueba y su zona de rechazo.

```{r}
ggchisqtest(chi_results)
```

A partir de estos resultados, podemos reportar lo siguiente:

> A raíz de la prueba de $X^2$, vemos que existe evidencia para rechazar la hipótesis nula sobre no asociación. Por ende, la asociación entre el nivel educacional y el tipo de sistema de salud al que pertenecen las personas en Chile es estadísticamente significativa ($X^2$ = 217, _p < 0.05_)

## 3.4. Tamaño de efecto con Phi y V de Cramer

### Estadístico Phi (Φ)

El estadístico Phi mide la asociación entre dos variables categóricas en una tabla de contingencia de 2x2. La fórmula es:

$$
\Phi = \sqrt{\frac{\chi^2}{n}}
$$

donde:

- $\chi^2$ es el valor del estadístico chi-cuadrado,
- $n$ es el tamaño total de la muestra.

El valor de $\Phi$ varía entre -1 y 1. Un valor de 0 indica ausencia de asociación, mientras que valores cercanos a -1 o 1 indican una asociación más fuerte.

### V de Cramer

El V de Cramer es una extensión del estadístico Phi para tablas de contingencia mayores de 2x2. Su fórmula es:

$$
V = \sqrt{\frac{\chi^2}{n(k-1)}}
$$

donde:

-  $\chi^2$ es el valor del chi-cuadrado,
-  $n$ es el tamaño de la muestra,
-  $k$ es el número de filas o columnas, el que sea menor.

Los valores de $V$ también varían entre 0 y 1, donde 0 indica ausencia de asociación, y valores cercanos a 1 indican una asociación más fuerte.

En nuestro ejemplo, nuestra tabla de contingencia es de 4x2, por ende, debemos usar el estadístico V de Cramer. En R lo podemos calcular directamente siguiendo la formula:

```{r}

# Guardar el test de chi cuadrado
chi_result <- chisq.test(table(proc_casen$ss_salud, proc_casen$universitaria))
n <- na.omit(proc_casen %>% select(ss_salud, universitaria)) %>% nrow()

# Cálculo de V de Cramer
cramer <- sqrt(chi_result$statistic / n*(2-1))
cramer
```

o directamente con sjstats

```{r}
sjstats::cramer(table(proc_casen$ss_salud, proc_casen$universitaria))
```

 Con un valor de `r round(cramer[[1]], 3)`, vemos que la magnitud de la asociación entre las variables es moderada.


# Ejercicio autónomo

A partir de la base de datos de `proc_elsoc` responda las siguientes preguntas: 

a) _¿En qué medida se relacionan los ingresos con la justificación de la violencia por el cambio social en Chile al año 2019?_

b) _¿En qué medida se relacionan el nivel educacional y la justificación de la violencia por el **control social** en Chile al año 2019?_

Para eso, descargue la siguiente base de datos `proc_elsoc`:

```{r}
# Cargar bbdd desde internet
load(url("https://github.com/cursos-metodos-facso/datos-ejemplos/raw/refs/heads/main/elsoc2019_jv.RData"))
```

seleccione las siguientes variables:

```{r}
proc_elsoc <- elsoc %>% # seleccionamos
    dplyr::select(
        ingreso,
        ingreso_rec,
        educ,
        educ_rec,
        starts_with("jv")
    )
```

y explore los estadísticos descriptivos:

```{r}
proc_elsoc %>%
    select(ingreso, ingreso_rec, educ, educ_rec, jv_cambio, jv_cambio_rec, jv_control, jv_control_rec) %>%
    sjmisc::descr(show = c("label", "range", "mean", "sd", "NA.prc", "n")) %>%
    kable(., "markdown")
```

Para la pregunta a)

1. Estime la correlación adecuada para `ingreso_rec` y `jv_control_rec`.

```{r}
matriz <- proc_elsoc %>%
    dplyr::select(jv_cambio_rec, ingreso_rec) # creamos matriz con var de interes

psych::tetrachoric(matriz, na.rm = T)
```

2. Presente en una tabla de contingencia entre las variables `ingreso_rec` y `jv_control_rec`.

```{r}
proc_elsoc %>%
    sjPlot::sjtab(ingreso_rec,
        jv_cambio_rec,
        show.row.prc = TRUE, # porcentaje fila
        show.col.prc = TRUE # porcentaje columna
    )
```

3. Calcule el estadístico de Chi cuadrado ($X^2$) entre las variables `ingreso_rec` y `jv_control_rec`.

```{r}
chi_results <- chisq.test(proc_elsoc$ingreso_rec, proc_elsoc$jv_cambio_rec)

stats.table <- tidy(chi_results, conf_int = T)
nice_table(stats.table)
```

4. Interprete los resultados obtenidos. Responda la pregunta de investigación a raíz de los calculos desarrollados.


Para la pregunta b)

1. Estime la correlación adecuada para `educ` y `jv_control_rec`.

Para determinar cuál es la correlación adecuada entre `educ` y `jv_control_rec` tenemos que tener en consideración el nivel de medición de estas variables. Vemos que `educ` es continua y `jv_control_rec` es una variable categorica nominal binaria. Para estos casos, una buena alternativa es la _correlación punto biserial_. Estimemosla en R:

```{r}
cor.test(proc_elsoc$educ, proc_elsoc$jv_control_rec)
```

```{r, warning=FALSE, include=FALSE}
rpb2 <- round(cor.test(proc_elsoc$educ, proc_elsoc$jv_control_rec)$estimate, 2)
```

Vemos que la correlación entre el nivel educacional (`educ`) y la justificación de la violencia por el control social (`jv_control_rec`) es negativa, muy pequeña y es estadísticamente significativa ($r$ = `r rpb2`; _p < 0.05_).

2. Presente en una tabla de contingencia entre las variables `educ_rec` y `jv_control_rec`.

Seguimos trabajando con `jv_control_rec`, pero ahora con `educ_rec` que corresponde al nivel educacional recodificado en dos categorías: 1 = Universitario o más y 0 = No universitario. Una tabla de contingencia la podemos realizar con la función `sjtab()` del paquete `sjPlot`.

```{r}
sjPlot::sjtab(proc_elsoc, educ_rec, jv_control_rec, show.row.prc = TRUE, show.col.prc = TRUE)
```

3. Calcule el estadístico de Chi cuadrado ($X^2$) entre las variables `educ_rec` y `jv_control_rec`.

El Chi cuadrado ($X^2$) entre las variables `educ_rec` y `jv_control_rec` los podemos obtener a partir de la función `chisq.test()`:

```{r}
chisq.test(proc_elsoc$educ_rec, proc_elsoc$jv_control_rec)
```

```{r include = FALSE}
xi2 <- round(chisq.test(proc_elsoc$educ_rec, proc_elsoc$jv_control_rec)$statistic[[1]], 3)
```

A partir de estos resultados, podemos reportar lo siguiente:

> A raíz de la prueba de $X^2$, vemos que no existe evidencia para rechazar la hipótesis nula sobre no asociación. Por ende, la asociación entre el nivel educacional y la justificación de la violencia por el control social no es estadísticamente significativa ($X^2$ = `r xi2`, _p > 0.05_)

4. Interprete los resultados obtenidos. Responda la pregunta de investigación a raíz de los calculos desarrollados.

En el presente ejercicio indagamos en la _relación entre el nivel educacional de las personas y las justificaciones de la violencia por el control social en Chile al año 2019_. Considerando que las variables de estudio tenían un nivel de medición categórico nominal, utilizamos la técnica de Chi-cuadrado $X^2$ para el contraste de hipótesis.

La hipótesis planteada inicialmente sugería que el nivel educacional podría estar asociado con las actitudes hacia la justificación de la violencia como una forma de control social. Sin embargo, los resultados de la prueba $X^2$, indican que **no** existe una asociación estadísticamente significativa entre estas variables ($X^2$ = `r xi2`, _p > 0.05_).

Esto significa que, según los datos analizados, el nivel educacional no parecen ser un factor que influya en la justificación de la violencia para el control social, por lo tanto, no podemos concluir que el nivel educacional estén relacionados con la justificación de la violencia en el contexto del cambio social en Chile en 2019.


## Video de la sesión

<iframe width="560" height="315" src="https://www.youtube.com/embed/EQlI0XQFCP4?si=1_uPc9LDZnY9LxyC" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

Acá [link directo a youtube.](https://youtu.be/EQlI0XQFCP4)

