---
title: "Inferencia 4: Pruebas de hipótesis II"
date: "2023-10-27"
lang: es
website:
  comments:
    giscus:
      repo: cursos-metodos-facso/correlacional
---

# Objetivo de la práctica

El objetivo de esta guía práctica es profundizar en la inferencia estadóstica, particularmente en el contraste de hipótesis de diferencias entre dos grupos. 

En detalle, aprenderemos:

1.  Aplicar pruebas de hipótesis direccionales.
2.  Aplicar inferencia estadística a proporciones.
3.  Emplear la correlación en contexto de inferencia.


## Recursos de la práctica

En esta práctica trabajaremos con un subconjunto de datos previamente procesados de la Encuesta de Caracterización Socioeconómica (CASEN) del año 2022, elaborada por el [Ministerio de Desarrollo Social y Familia](https://observatorio.ministeriodesarrollosocial.gob.cl/). Para este ejercicio, obtendremos directamente esta base desde internet. No obstante, también tienes la opción de acceder a la misma información a través del siguiente enlace: [{{< fa table >}} `CASEN 20222`](https://github.com/cursos-metodos-facso/datos-ejemplos/raw/main/proc_casen.RData). Desde allí, podrás descargar el archivo que contiene el subconjunto procesado de la base de datos CASEN 2022.


## Cinco pasos para la inferencia estadística

En inferencia, las pruebas de hipótesis nos ayudan a determinar si el resultado que obtenemos en nuestra muestra es un efecto real/extensible a la población o un error de muestreo. Aquí recomendamos una lista de cinco pasos lógicos para enfrentarnos a la inferencia estadística: 

<style>
  table {
    margin-left: auto; /* Ajustamos el margen izquierdo a automático */
    margin-right: auto; /* Ajustamos el margen derecho a automático */
    border-collapse: collapse;
    width: 60%;
    border: 2px solid black;
  }
  
  th, td {
    border: 1px solid #D3D3D3;
    padding: 8px;
    text-align: center;
  }
</style>

<table>
  <tr>
    <th class="cell-left">Paso</th>
    <th class="cell-left"> Detalle</th>
  </tr>
  <tr>
    <td class="cell-left">1&emsp;</td>
    <td class="cell-left">Formula $H_0$ y $H_A$ y estipula la dirección de la prueba</td>
  </tr>
  <tr>
    <td class="cell-left">2</td>
    <td class="cell-left">Calcula el error estándar (SE)</td>
  </tr>
  <tr>
    <td class="cell-left">3</td>
    <td class="cell-left">Calcula el valor estimado de la prueba (ej: Z o t)E</td>
  </tr>
  <tr>
    <td class="cell-left">4</td>
    <td class="cell-left">Especifica el valor crítico de la prueba</td>
  </tr>
  <tr>
    <td class="cell-left">5</td>
    <td class="cell-left">Contrasta el valor estimado con el valor crítico e intrepreta los resultados</td>
  </tr>
</table>

# Preparación datos

Comencemos por preparar nuestros datos. Iniciamos cargando las librerías necesarias.

```{r librerias, echo=TRUE, message=FALSE, warning=FALSE, collapse=TRUE}
pacman::p_load(tidyverse, # Manipulacion datos
               sjPlot, #tablas
               confintr, # IC
               gginference, # Visualizacion 
               rempsyc, # Reporte
               broom) # Varios

options(scipen = 999) # para desactivar notacion cientifica
rm(list = ls()) # para limpiar el entorno de trabajo
```

Cargamos los datos directamente desde internet.

```{r datos, echo=TRUE, message=FALSE, warning=FALSE}

load(url("https://github.com/cursos-metodos-facso/datos-ejemplos/raw/main/proc_casen.RData")) #Cargar base de datos

```

A continuación, exploramos la base de datos **proc_casen**.

```{r exploracion, echo=TRUE, message=FALSE, warning=FALSE}

names(proc_casen) # Nombre de columnas
dim(proc_casen) # Dimensiones

```
Contamos con 24 variables (columnas) y 202.111 observaciones (filas).


# Pruebas de hipótesis direccionales para la media

```{r echo=FALSE, warning=FALSE, out.width="70%", fig.align='center'}
knitr::include_graphics("../files/stop.gif", error = FALSE)
```

#### Recordemos...

En estadística, la formulación de hipótesis que implica dos variables (o la comparación de grupos) busca determinar si existen diferencias en una variable entre grupos y, de ser el caso, evaluar si esta diferencia es estadísticamente significativa.

[Hasta ahora](https://correlacional.netlify.app/assignment/07-practico), hemos aprendido a contrastar hipótesis sobre **diferencias entre grupos**. A esto también se le llama **hipótesis de dos colas**. 

::: {.callout-tip}
#### Prueba de dos colas

Contrastamos la _hipótesis nula_ (o de trabajo) de _no_ diferencias entre grupos:
$$  H_{0}: \mu_{1} - \mu_{2} = 0 $$
En relación a una _hipótesis alternativa_ sobre _diferencias_ entre grupos:
$$  H_{A}: \mu_{1} - \mu_{2} \neq 0 $$
:::


Pero, los intervalos de confianza **también pueden ser útiles para determinar si existen diferencias estadísticamente significativas entre dos grupos**. ¿Cómo?: 

> Si no hay superposición de intervalos, hay diferencias poblacionales entre los grupos que estamos comparando.


### a) Intervalos de confianza para la media

Veamos un ejemplo con nuestros datos. Obtengamos el promedio y un intervalo de confianza para los ingresos del trabajo para hombres y mujeres ocupadas en Chile en el 2022.

Apliquemos nuestros seis pasos para inferencia.

1. Formulamos nuestras hipótesis y dirección de la prueba:

- $H_{0}$: $\mu_{hombres}$ $-$ $\mu_{mujeres}$ $=$ $0$

- $H_{A}$: $\mu_{hombres}$ $-$ $\mu_{mujeres}$ $\neq$ $0$ 

2. Calculamos el error estándar (SE):

```{r ci_mean, echo=TRUE, message=FALSE, warning=FALSE, collapse=FALSE}
ocupados <- proc_casen %>%
  filter(ocupado == 1) #  subset de datos solo con personas ocupadas

datos_ic <- ocupados %>% 
  group_by(sexo) %>% 
  summarise(media = mean(ytrabajocor, na.rm = T),
            ds = sd(ytrabajocor, na.rm = T),
            n = n(),
            se = (ds/sqrt(n)))

datos_ic
```

3. Calcula el valor estimado de la prueba:

Esto ya lo hicimos en el paso anterior estimando la $\bar{x}$ muestral para hombres y mujeres.

4. Especifica el valor crítico de la prueba:

```{r ci_mean_1, echo=TRUE, message=FALSE, warning=FALSE, collapse=FALSE}

datos_ic <- datos_ic %>% 
  group_by(sexo) %>% 
  mutate(critico = qt(0.975, df = n - 1))

datos_ic
```

5. Contrasta el valor estimado con el crítico e interpreta los resultados: 

```{r, echo=TRUE, message=FALSE, warning=FALSE, collapse=FALSE}

datos_ic %>% 
  group_by(sexo) %>% 
  summarise(media,
            l_inf = media - critico * se,
            l_sup = media + critico * se)

```

Para el caso de los hombres, su $\bar{x}$ es de 768.422, con un IC[760.057	- 776.787]. Para las mujeres, el 
$\bar{x}$ es de 606.662, con un IC[599.998 -	613.326].

Vemos que, en este caso, los intervalos **no se solapan**. Así, podemos sostener que, con un 95% de confianza, existen diferencias poblacionales en el promedio de ingresos del trabajo entre hombres y mujeres en Chile en el 2022.

6. Y el cálculo directo en R:

```{r ci_mean_r, echo=TRUE, message=FALSE, warning=FALSE, collapse=TRUE}
ocupados_h <- ci_mean(ocupados$ytrabajocor[ocupados$sexo == 1]) # IC para hombres

ocupados_m <- ci_mean(ocupados$ytrabajocor[ocupados$sexo == 2]) # IC para mujeres

ocupados_h; ocupados_m
```

### b) Prueba t direccional para la media

Ya hemos visto cómo contrastar hipótesis solo para diferencias entre grupos. Sin embargo, también podemos **plantear hipótesis** respecto a que el valor de cierto parámetro para un grupo **puede ser mayor o menor** al de otro grupo. A esto se le conoce como **hipótesis de una cola**. 

::: {.callout-tip}
#### Prueba de una cola

$$  H_{0}: \mu_{0} ≥ \mu_{1} ; \mu_{0} ≤ \mu_{1}$$

$$  H_{A}: \mu_{0} > \mu_{1} $$

$$  H_{A}: \mu_{0} < \mu_{1} $$

:::

Tomando como ejemplo el trabajo de la ganadora del Premio Nobel de Economía 2023 Claudia Goldin, comprobemos si los ingresos de las mujeres trabajadoras que no tienen hijos es mayor al ingreso de las mujeres trabajadoras que sí tienen hijos. Por tanto, usaremos **prueba $t$** para diferencia de medias.

Apliquemos nuestros 6 pasos.

1. Formulamos nuestras hipótesis y dirección de la prueba:

En donde 0 = sin hijos y 1 = con hijos;

- $H_{0}$: $\mu_{0}$ $≤$ $\mu_{1}$ 

- $H_{A}$: $\mu_{0}$ $>$ $\mu_{1}$


2. Calcula el error estándar (SE) para diferencia de medias:

```{r, echo=TRUE, warning=FALSE, message=FALSE, collapse=FALSE}

goldin_data <- proc_casen %>% 
  filter(ocupado == 1 & sexo == 2) %>% 
  na.omit()# creamos subset con solo mujeres ocupadas

datos_t <- goldin_data %>% 
  group_by(hijo) %>% 
  summarise(media = mean(ytrabajocor, na.rm = T),
            ds = sd(ytrabajocor, na.rm = T),
            n = n()) 

datos_t
```

En este caso, obtenemos la diferencia de medias ($\bar{x}_0 - \bar{x}_1$ ). 

```{r, echo=TRUE, warning=FALSE, message=FALSE, collapse=FALSE}
dif_medias <- 729850.1 - 655087.8
dif_medias
```

Y luego su error estándar.

```{r, echo=TRUE, warning=FALSE, message=FALSE, collapse=FALSE}

s_0 <- 659400.5	
s_1 <- 629290.5

n_0 <- 6807 
n_1 <- 19506	

se_dif <- sqrt((s_0^2)/n_0 + (s_1^2)/n_1)
se_dif
```

3. Calcula el valor estimado de la prueba (t para diferencia de medias):

```{r, echo=TRUE, warning=FALSE, message=FALSE, collapse=FALSE}

t_stat <- dif_medias / se_dif

t_stat
```


4. Calcula el valor estimado de la prueba:

```{r, echo=TRUE, warning=FALSE, message=FALSE, collapse=FALSE}

df <- n_0 + n_1 - 2 # definimos grados de libertad

t_critico <- qt(p = 0.05, df, lower.tail = FALSE)

t_critico
```


5. Contrasta el valor estimado con el crítico e interpreta los resultados:

```{r, echo=TRUE, warning=FALSE, message=FALSE, collapse=FALSE}

t_stat > t_critico

```


> La prueba T que evalúa la diferencia de medias entre el ingreso del trabajo y tener hijos en las mujeres ocupadas sugiere que el efecto es positivo y estadísticamente signficativo (diferencia = 74.762, t(11417.34) = 8.15, p < .05). Por tanto, rechazamos la $H_{0}$ sobre igualdad de medias con un 95% de confianza, existiendo evidencia a favor de nuestra $H_{A}$ respecto a que el ingreso de las mujeres sin hijos es mayor al ingreso de las mujeres con hijos. 

6. Y el cálculo en R.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
t_results_goldin <- t.test(goldin_data$ytrabajocor ~ goldin_data$hijo, 
                           alternative = "greater") # indicamos la direccion de la prueba

stats.table  <- tidy(t_results_goldin, conf.int = T)
nice_table(stats.table, broom = "t.test") 


```

Visualicemos la distribución de esta prueba y su zona de rechazo.

```{r t_goldin_graf, echo=TRUE, warning=FALSE, message=FALSE, collapse=TRUE}
ggttest(t_results_goldin)
```



# Inferencia para proporciones

Cuando queremos realizar inferencia para variables categóricas, generlamente utilizamos pruebas que comparan **proporciones de una variable de interés** entre grupos. Para esto, y siguiendo la lógica anterior, podemos utilizar intervalos de confianza para proporciones y pruebas de hipótesis para proporciones.

### a) Intervalos de confianza para proporciones

Cuando queremos obtener un intervalo de confianza para proporciones el cálculo es escencialmente el mismo que el de medias, pero con leves modificaciones.

Obtengamos la proporción y un intervalo de confianza de hombres y mujeres que se encuentran en situación de pobreza multidimensional en Chile en el 2022.

```{r ci_prop, echo=TRUE, message=FALSE, warning=FALSE, collapse=FALSE}

pobreza <- proc_casen[1:300,] # creamos un subsample solo como ejemplo 
  
pob_h <- ci_proportion(pobreza$pobreza_multi_5d[pobreza$sexo==1])

pob_m <- ci_proportion(pobreza$pobreza_multi_5d[pobreza$sexo==2])

```

Veamos los resultados.

```{r ci_prop_r, echo=TRUE, message=FALSE, warning=FALSE, collapse=TRUE}

pob_h; pob_m

```

En este caso, los intervalos **si se solapan**. Por ejemplo, el límite superior del IC de mujeres se toca con el IC de hombres. ¿Puedo decir entonces que _no_ hay diferencias significativas?

**NO tan rápido**, si los _intervalos sí se superponen, aún existe la posibilidad de que existan diferencias_ entre los grupos que estamos comparando. Aquí es donde entran las **pruebas de hipótesis**.

### b) Pruebas de hipótesis para proporciones

El test de proporciones es una prueba estadística utilizada para **determinar si hay una diferencia significativa entre dos proporciones (tasas) en dos grupos**. Se basa en datos categóricos, en donde **se cuentan los eventos "exitosos"** o "positivos" en cada grupo de comparación, por sobre el total de eventos.

Continuemos con el ejemplo anterior, pero ahora aplicando la prueba de hipótesis. Veamos la distribución del porcentaje por colmunas entre sexo y situación de pobreza:

```{r, echo=TRUE, warning=FALSE, message=FALSE, collapse=TRUE}

sjPlot::sjt.xtab(pobreza$sexo, pobreza$pobreza_multi_5d, show.col.prc = T)

```

Formulemos nuestras hipótesis:

- $H_0$: $p_{hombres}$ $=$ $p_{mujeres}$ 

- $H_A$: $p_{hombres}$ $\neq$ $p_{mujeres}$


Ahora, creemos un objeto llamado `xtab` que contendrá la frecuencia de casos exitosos ("pobreza") sobre el total de casos para cada grupo. Luego, aplicamos la función `prop.test()` para evaluar nuestra hipótesis.

```{r prop_test, echo=TRUE, warning=FALSE, message=FALSE}

xtab <- as.table(rbind(c(43, 91),c(47, 115)))

dimnames(xtab) <- list(
  sexo = c("hombre", "mujer"),
  pobreza = c("si", "no")
)

prop_results <- prop.test(xtab, alternative = "two.sided")

prop_results
```

¿Y cómo reportamos esto?: 

> Esta prueba que evalúa la diferencia de proporciones entre encontrarse en situación de pobreza según sexo sugiere que el efecto es positivo y estadísticamente no signficativo ($X^2$= 0.19887, p = 0.6556). Por tanto, no se rechaza la $H_{0}$ sobre igualdad de proporciones ya que no existe suficiente evidencia para concluir que las proporciones en los dos grupos son significativamente diferentes.


# Inferencia en correlación

En el contexto de la inferencia, **la correlación** nos permite **determinar si existe (o no) una asociación estadísticamente significativa** entre dos variables. En ese sentido, la lógica del contraste de hipótesis usando correlación es:

::: {.callout-tip}
#### Hipótesis en correlación

Contrastamos la _hipótesis nula_ (o de trabajo) de _no_ asociación entre variables:
$$  H_{0}: \rho = 0 $$

En relación a una _hipótesis alternativa_ sobre la existencia una asociación significativa entre variables:

$$  H_{A}: \rho \neq 0 $$
:::

Tomemos por ejemplo la siguiente pregunta de investigación: ¿en qué medida el nivel educacional alcanzado por las personas se relaciona con sus ingresos en Chile en el 2022?

Formulemos nuestra hipótesis:

- $H_{0}$: $cor(educ,ingreso)$ $=$ $0$

- $H_{A}$: $cor(educ,ingreso)$ $\neq$ $0$

Obtengamos el coeficiente de correlación $r$ de Pearson entre el nivel educacional alcanzado y los ingresos de las personas en Chile en 2022. Para esto usaremos solamente observaciones completas (_listwise_).


```{r cor_test, echo=TRUE, warning=FALSE, message=FALSE}

cor.test(proc_casen$educ, proc_casen$ytrabajocor, 
         method = "pearson", 
         use = "complete.obs")

```

Ya sabemos [cómo interpretar una correlación](https://correlacional.netlify.app/assignment/03-practico#tama%C3%B1os-de-efecto), ahora usemos este resultado para probar nuestra hipótesis: 

> El coeficiente de correlación de Pearson entre nivel educativo e ingresos es positivo, estadísticamente significativo (r = 0.38, p < .001) y moderado de acuerdo con las recomendaciones de Cohen (1988). Por tanto, con un 95% de confianza se puede rechazar la $H_{0}$ de no asociación entre variables, existiendo evidencia a favor de la $H_{A}$ sobre una asociación significativa entre educación e ingresos.


# Resumen

Hoy profundizamos en la inferencia estadóstica, particularmente en el contraste de hipótesis de diferencias entre dos grupos. 

En detalle, aprendimos a:

1.  Aplicar pruebas de hipótesis direccionales.
2.  Aplicar inferencia estadística a proporciones.
3.  Emplear la correlación en contexto de inferencia.

# Reporte de progreso

Completar el reporte de progreso correspondiente a esta práctica [aquí](). El plazo para contestarlo es hasta el día viernes de la semana en la que se publica la práctica correspondiente.

# Video de práctica


# Foro

<script src="https://giscus.app/client.js"
        data-repo="cursos-metodos-facso/correlacional"
        data-repo-id="R_kgDOKCMXJQ"
        data-category="Q&A"
        data-category-id="DIC_kwDOKCMXJc4CYd9S"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="es"
        crossorigin="anonymous"
        async>
</script>
